<body>
  <h1>„Éê„Éº„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥</h1>
  <video id="video" width="400" height="300" style="border:1px solid black"></video>
  <div id="result" style="margin-top:10px; font-size:1.5em; color:green;"></div>

  <script>
    const codeReader = new ZXing.BrowserBarcodeReader();
    const videoElement = document.getElementById('video');
    const resultDisplay = document.getElementById('result');
    const GAS_URL = "https://script.google.com/macros/s/XXXXX/exec";

    let scanning = true;

    codeReader.decodeFromVideoDevice(null, videoElement, (result, err) => {
      if (!scanning || !result) return;

      const barcode = result.text;
      scanning = false;

      // üîä Èü≥„ÇíÈ≥¥„Çâ„Åô
      new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();

      // üì∏ Êò†ÂÉè„Çí‰∏ÄÁû¨Êöó„Åè„Åô„Çã
      videoElement.style.opacity = "0.3";
      setTimeout(() => {
        videoElement.style.opacity = "1";
      }, 300);

      // üìã Ë™≠„ÅøÂèñ„Å£„Åü„Éê„Éº„Ç≥„Éº„Éâ„ÇíÁîªÈù¢„Å´Ë°®Á§∫
      resultDisplay.textContent = "Ë™≠„ÅøÂèñ„Çä: " + barcode;

      // üì° GAS„Å´ÈÄÅ‰ø°
      fetch(GAS_URL + "?barcode=" + encodeURIComponent(barcode))
        .then(() => console.log("ÈÄÅ‰ø°ÊàêÂäü"))
        .catch(e => console.error(e));

      // ‚è± 1ÁßíÂæå„Å´ÂÜç„Çπ„Ç≠„É£„É≥ÂèØËÉΩ„Å´„Åô„Çã
      setTimeout(() => {
        scanning = true;
      }, 1000);
    });
  </script>
</body>
